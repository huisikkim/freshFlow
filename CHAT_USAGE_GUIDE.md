# 📱 채팅 기능 사용 가이드

## 채팅 기능 접근 방법

채팅 기능은 두 가지 방법으로 접근할 수 있습니다:

### 1️⃣ 홈 화면에서 접근

**가게 사장님:**
1. 로그인 후 홈 화면
2. "채팅" 메뉴 클릭 (파란색 말풍선 아이콘)
3. 유통업체와의 채팅 목록 확인

**유통업체:**
1. 로그인 후 홈 화면
2. "채팅" 메뉴 클릭 (파란색 말풍선 아이콘)
3. 가게와의 채팅 목록 확인

### 2️⃣ 견적 요청 상세 화면에서 접근

**가게 사장님:**
1. 홈 화면 → "견적 요청하기" 메뉴
2. 견적 요청 목록에서 특정 견적 선택
3. 견적 상세 화면에서 "유통업체와 채팅하기" 버튼 클릭
4. 해당 유통업체와 1:1 채팅 시작

**유통업체:**
1. 홈 화면 → "견적 요청 확인" 메뉴
2. 받은 견적 요청 목록에서 특정 견적 선택
3. 견적 상세 화면에서 "매장과 채팅하기" 버튼 클릭
4. 해당 매장과 1:1 채팅 시작

## 📋 화면 구성

### 채팅 목록 화면
- 대화 중인 모든 채팅방 표시
- 각 채팅방 정보:
  - 상대방 이름 (가게명 또는 유통업체명)
  - 마지막 메시지 시간
  - 읽지 않은 메시지 수 (빨간 배지)
- Pull-to-refresh로 목록 새로고침

### 채팅방 화면
- 상단: 상대방 이름
- 중앙: 메시지 목록
  - 내 메시지: 오른쪽 정렬 (파란색)
  - 상대방 메시지: 왼쪽 정렬 (회색)
  - 시스템 메시지: 중앙 정렬 (연한 회색)
- 하단: 메시지 입력창 + 전송 버튼
- 스크롤 위로 올리면 이전 메시지 자동 로드

## 💬 메시지 타입

### 일반 텍스트 (TEXT)
- 기본 메시지 형태
- 자유롭게 대화 가능

### 주문 문의 (ORDER_INQUIRY)
- 주문 관련 문의 메시지
- 주문 아이콘과 함께 표시

### 견적 요청 (QUOTE_REQUEST)
- 견적 요청 메시지
- 견적 요청 아이콘과 함께 표시

### 견적 응답 (QUOTE_RESPONSE)
- 견적 응답 메시지
- 견적서 아이콘과 함께 표시

### 시스템 메시지 (SYSTEM)
- 자동 생성 메시지
- 주문 완료, 상태 변경 등

## 🔔 주요 기능

### 실시간 메시지
- WebSocket 기반 실시간 통신
- 메시지 전송 즉시 상대방에게 전달
- 앱이 열려있으면 자동으로 메시지 수신

### 읽지 않은 메시지
- 채팅방 목록에서 읽지 않은 메시지 수 표시
- 채팅방 입장 시 자동으로 읽음 처리

### 무한 스크롤
- 스크롤을 위로 올리면 이전 메시지 자동 로드
- 페이징 처리로 성능 최적화

## 🎯 사용 시나리오

### 시나리오 1: 견적 요청 후 추가 문의
1. 가게 사장님이 견적 요청 전송
2. 견적 상세 화면에서 "유통업체와 채팅하기" 클릭
3. 추가 문의사항 채팅으로 전달
4. 유통업체가 실시간으로 답변

### 시나리오 2: 주문 관련 문의
1. 주문 완료 후 배송 관련 문의 필요
2. 홈 화면 → "채팅" 메뉴
3. 해당 유통업체와의 채팅방 선택
4. 배송 시간, 장소 등 문의

### 시나리오 3: 정기 거래 협의
1. 여러 번 거래한 유통업체와 정기 거래 협의
2. 채팅으로 수량, 가격, 배송 주기 등 협의
3. 합의 후 정기 주문 진행

## ⚠️ 주의사항

### WebSocket 연결
- 로그인 후 자동으로 WebSocket 연결
- 앱이 백그라운드로 가면 연결 해제
- 앱을 다시 열면 자동 재연결

### 메시지 전송
- 인터넷 연결 필요
- 연결이 끊어지면 메시지 전송 실패
- 재연결 후 다시 시도

### 채팅방 생성
- 견적 요청이 있어야 채팅방 생성 가능
- storeId와 distributorId로 1:1 매칭

## 🔧 문제 해결

### "Could not find the correct Provider" 에러
**원인:** ChatProvider가 제공되지 않은 상태에서 접근
**해결:**
1. 앱을 완전히 종료하고 재시작 (Hot Reload가 아닌 Hot Restart)
2. 로그아웃 후 다시 로그인
3. 견적 상세 페이지는 자동으로 ChatProvider를 제공하므로 정상 작동해야 함

### 메시지가 전송되지 않아요
1. 인터넷 연결 확인
2. 로그인 상태 확인 (로그아웃 후 다시 로그인)
3. WebSocket 연결 상태 확인
4. 앱 재시작

### 채팅 목록이 보이지 않아요
1. Pull-to-refresh로 새로고침
2. 견적 요청을 먼저 보내보세요 (채팅방은 견적 요청 후 생성됨)
3. 로그아웃 후 다시 로그인
4. 앱 재시작

### 실시간으로 메시지가 안 와요
1. 로그인 시 자동으로 WebSocket 연결됨
2. 앱을 포그라운드로 유지
3. 로그아웃 후 다시 로그인하여 WebSocket 재연결
4. 앱 재시작

## 📱 화면 흐름도

```
홈 화면
  ├─ [채팅] 버튼 클릭
  │   └─ 채팅 목록 화면
  │       └─ 채팅방 선택
  │           └─ 채팅방 화면
  │
  └─ [견적 요청하기] 버튼 클릭
      └─ 견적 요청 목록
          └─ 견적 상세 화면
              └─ [유통업체와 채팅하기] 버튼 클릭
                  └─ 채팅방 화면
```

## 🎨 UI 특징

### 색상 구분
- 내 메시지: 파란색 배경 (#4A90E2)
- 상대방 메시지: 회색 배경
- 시스템 메시지: 연한 회색 배경
- 채팅 버튼: 파란색 (#4A90E2)

### 아이콘
- 채팅 목록: 말풍선 아이콘
- 읽지 않은 메시지: 빨간 원형 배지
- 메시지 타입별 아이콘 표시

### 시간 표시
- 오늘: HH:mm 형식
- 어제: "어제"
- 7일 이내: "N일 전"
- 그 이상: MM/dd 형식

## 🚀 향후 추가 예정 기능

- [ ] 이미지 전송
- [ ] 파일 전송
- [ ] 푸시 알림
- [ ] 메시지 검색
- [ ] 읽음 표시 (상대방이 읽었는지)
- [ ] 타이핑 인디케이터 (상대방이 입력 중)
- [ ] 메시지 삭제
- [ ] 채팅방 나가기
